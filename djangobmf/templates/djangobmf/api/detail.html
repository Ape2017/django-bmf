{% load i18n %}{% spaceless %}{% verbatim %}
<!--
<h2>Header (todo):</h2>
<ul>
    <li>clone-view</li>
    <li>report-view(s)</li>
    <li>notifications</li>
    <li>files (?)</li>
</ul>
-->
<div class="clearfix">
    <div class="btn-toolbar pull-left" role="toolbar">
        <div ng-if="ui.workflow && ui.workflow.transitions.length > 0" class="btn-group">
            <button type="button" class="btn btn-bmfworkflow dropdown-toggle" data-toggle="dropdown">{{ ui.workflow.name }} <span class="caret"></span></button>
                <ul class="dropdown-menu" role="menu">
                    <li ng-repeat="obj in ui.workflow.transitions">
                        <a class="bmf-edit" bmf-form="workflow" href="{{ obj.url }}">{{ obj.name }}</a>
                    </li>
                </ul>
        </div>
        <div ng-if="ui.workflow && ui.workflow.transitions.length == 0" class="btn-group">
            <button type="button" class="btn btn-default disabled">{{ ui.workflow.name }} <span class="caret"></span></button>
        </div>
    </div>
    <div class="btn-toolbar pull-right" role="toolbar">

        {{ ui.notifications }}
        {% if bmfactivity.notification %}
            {% if bmfactivity.watch %}
                <a href="{% url "djangobmf:notification-update" pk=bmfactivity.notification.pk %}" class="btn {% if bmfactivity.notification.unread %}btn-info{% else %}btn-default{% endif %} bmf-edit">
                    <span class="glyphicon glyphicon-star"></span>
                </a>
            {% else %}
                <a href="{% url "djangobmf:notification-update" pk=bmfactivity.notification.pk %}" class="btn btn-default bmf-edit">
                    <span class="glyphicon glyphicon-star-empty"></span>
                </a>
            {% endif %}
        {% else %}
            <a href="{% url 'djangobmf:notification-create' ct=bmfactivity.ct pk=object.pk %}" class="btn btn-default bmf-edit">
                <span class="glyphicon glyphicon-star-empty"></span>
            </a>
        {% endif %}

        <div ng-if="!ui.workflow || ui.workflow && ui.workflow.update" class="btn-group">
            <a class="btn btn-bmfupdate" bmf-form="update" href="{{ ui.views.update }}"><span class="glyphicon glyphicon-wrench"></span> {% endverbatim %}{% trans "Edit" %}{% verbatim %}</a>
        </div>
        <div ng-if="ui.workflow && !ui.workflow.update" class="btn-group">
            <a class="btn btn-default disabled" href="#"><span class="glyphicon glyphicon-wrench"></span> {% endverbatim %}{% trans "Edit" %}{% verbatim %}</a>
        </div>

        <div ng-if="!ui.workflow || ui.workflow && ui.workflow.delete" class="btn-group">
            <a class="btn btn-bmfdelete" bmf-form="delete" href="{{ ui.views.delete }}"><span class="glyphicon glyphicon-trash"></span></a>
        </div>
        <div ng-if="ui.workflow && !ui.workflow.delete" class="btn-group">
            <a class="btn btn-default disabled" href="#"><span class="glyphicon glyphicon-trash"></span></a>
        </div>

    </div>
</div>
<hr>
<bmf-template></bmf-template>
<hr>
<!--
<h2>Footer: (todo)</h2>
<ul>
    <li>write comments</li>
    <li>upload files</li>
    <li>paginated</li>
</ul>
-->
<div class="panel panel-default" id="bmf_message_box">
    <div ng-if="ui.views.comments" class="panel-heading text-right">
        <button type="button" data-toggle="collapse" data-target="#bmf_message_form" data-parent="#bmf_message_box" class="btn btn-default">
            <span class="glyphicon glyphicon-pencil"></span> {% endverbatim %}{% trans "Write message" %}{% verbatim %}
        </button>
    </div>
    <div class="panel-body">

        <div ng-if="ui.views.comments" id="bmf_message_form" class="collapse out">
            <form class="form" role="form" ng-controller="ActivityFormCtrl" ng-submit="processForm()">
                <div class="form-group">
                    <input type="text" name="topic" class="form-control" placeholder="{% endverbatim %}{% trans "Topic" %}{% verbatim %}" ng-model="data.topic">
                </div>
                <div class="form-group">
                    <textarea class="form-control" name="text" rows="8" placeholder="{% endverbatim %}{% trans "Text" %}{% verbatim %}" ng-model="data.text"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-success">{% endverbatim %}{% trans "Write message" %}{% verbatim %}</button>
                </div>
            </form>
            <hr />
        </div>

        <div ng-repeat="activity in activities">
            <h4 ng-if="activity.action=='created'">{% endverbatim %}{% trans "Item created"%}{% verbatim %}</h4>
            <h4 ng-if="activity.action=='changed'">{% endverbatim %}{% trans "Item changed"%}{% verbatim %}</h4>
            <strong ng-if="activity.action=='workflow'">{% endverbatim %}{% trans "State"%}{% verbatim %}: {{ activity.json.new }} &larr; {{ activity.json.old }} <br></strong>
            <h4 ng-if="activity.topic">{{ activity.topic }}</h4>
            <div ng-if="activity.formatted" ng-bind-html="activity.formatted | mark_safe"></div>
            <small class="text-muted">{{ activity.user }} <span bmf-time-ago="activity.modified"></span></small>
            <hr ng-if="!$last">
        </div>
    </div>
</div>
{% endverbatim %}{% endspaceless %}
